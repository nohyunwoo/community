<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìƒˆ ê¸€ ì‘ì„± - ComeOn</title>
  <link rel="stylesheet" href="/post.css">
</head>

<body>
  <div th:replace="nav :: navbar"></div>

  <main>
    <div class="container">
      <div class="page-header">
        <div class="page-title">
          <h1>ìƒˆ ê¸€ ì‘ì„±</h1>
          <p>ììœ ë¡­ê²Œ ì—¬ëŸ¬ë¶„ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”</p>
        </div>
        <div class="breadcrumb">
          <a href="#home">í™ˆ</a> > <a href="#board">ê²Œì‹œíŒ</a> > ìƒˆ ê¸€ ì‘ì„±
        </div>
      </div>

      <form class="write-form" id="writeForm">
        <div class="form-group required">
          <label for="category">ì¹´í…Œê³ ë¦¬</label>
          <select id="category" class="form-control category-select" required>
            <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            <option value="free">ììœ ê²Œì‹œíŒ</option>
            <option value="qna">ì§ˆë¬¸ë‹µë³€</option>
            <option value="info">ì •ë³´ê³µìœ </option>
            <option value="review">í›„ê¸°</option>
            <option value="hobby">ì·¨ë¯¸</option>
            <option value="study">ìŠ¤í„°ë””</option>
          </select>
        </div>

        <div class="form-group required">
          <label for="title">ì œëª©</label>
          <input type="text" id="title" class="form-control" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required maxlength="100">
          <div class="char-counter" id="titleCounter">0 / 100</div>
        </div>

        <div class="form-group required">
          <label for="content">ë‚´ìš©</label>
          <div class="writing-options">
            <button type="button" class="btn btn-primary btn-sm" onclick="togglePreview()">ë¯¸ë¦¬ë³´ê¸°</button>
            <div class="option-toggle">
              <input type="checkbox" id="allowComments" checked>
              <label for="allowComments">ëŒ“ê¸€ í—ˆìš©</label>
            </div>
            <div class="option-toggle">
              <input type="checkbox" id="isNotice">
              <label for="isNotice">ê³µì§€ì‚¬í•­</label>
            </div>
          </div>
          <textarea id="content" class="form-control" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...

ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ í¬í•¨í•˜ì—¬ ì‘ì„±í•´ë³´ì„¸ìš”:
â€¢ ì—¬ëŸ¬ë¶„ì˜ ê²½í—˜ì´ë‚˜ ìƒê°
â€¢ ìœ ìš©í•œ ì •ë³´ë‚˜ íŒ
â€¢ ì§ˆë¬¸ì´ë‚˜ ë„ì›€ ìš”ì²­
â€¢ ì·¨ë¯¸ë‚˜ ê´€ì‹¬ì‚¬ ê³µìœ 

ì„œë¡œ ì¡´ì¤‘í•˜ë©° ê±´ì „í•œ ì†Œí†µì„ ìœ„í•´ ë…¸ë ¥í•´ì£¼ì„¸ìš”." required></textarea>
          <div class="preview-mode" id="previewMode">
            <div class="preview-title" id="previewTitle">ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”</div>
            <div id="previewContent">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”</div>
          </div>
          <div class="char-counter" id="contentCounter">0 / 10000</div>
        </div>

        <div class="form-group">
          <label>ì²¨ë¶€íŒŒì¼</label>
          <div class="file-upload">
            <input type="file" id="fileInput" class="file-upload-input" multiple accept="image/*,.pdf,.doc,.docx,.txt">
            <label for="fileInput" class="file-upload-label">
              ğŸ“ íŒŒì¼ ì„ íƒ (ìµœëŒ€ 5ê°œ, 10MB ì´í•˜)
            </label>
          </div>
          <div class="file-list" id="fileList"></div>
        </div>

        <div class="form-group">
          <label for="tags">íƒœê·¸</label>
          <input type="text" id="tags" class="form-control" placeholder="íƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì‰¼í‘œë¡œ êµ¬ë¶„)">
          <small style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 0.5rem; display: block;">
            ì˜ˆ: ë§›ì§‘, ì¹´í˜, ê°•ë‚¨ì—­, ì¶”ì²œ
          </small>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-outline" onclick="saveDraft()">ì„ì‹œì €ì¥</button>
          <button type="button" class="btn btn-outline" onclick="goBack()">ì·¨ì†Œ</button>
          <button type="submit" class="btn btn-success">ê²Œì‹œê¸€ ë“±ë¡</button>
        </div>
      </form>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 ComeOn. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ .</p>
    </div>
  </footer>

  <script>
    let uploadedFiles = [];
    let isPreviewMode = false;

    // ë¬¸ì ìˆ˜ ì¹´ìš´í„°
    function updateCharCounter(input, counter, maxLength) {
        const current = input.value.length;
        const counterEl = document.getElementById(counter);
        counterEl.textContent = `${current} / ${maxLength}`;

        if (current > maxLength * 0.9) {
            counterEl.className = 'char-counter danger';
        } else if (current > maxLength * 0.7) {
            counterEl.className = 'char-counter warning';
        } else {
            counterEl.className = 'char-counter';
        }
    }

    // ì œëª© ì¹´ìš´í„°
    document.getElementById('title').addEventListener('input', function() {
        updateCharCounter(this, 'titleCounter', 100);
        updatePreview();
    });

    // ë‚´ìš© ì¹´ìš´í„°
    document.getElementById('content').addEventListener('input', function() {
        updateCharCounter(this, 'contentCounter', 10000);
        updatePreview();
    });

    // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
    document.getElementById('fileInput').addEventListener('change', function() {
        const files = Array.from(this.files);

        for (let file of files) {
            if (uploadedFiles.length >= 5) {
                alert('ìµœëŒ€ 5ê°œì˜ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                break;
            }

            if (file.size > 10 * 1024 * 1024) {
                alert(`${file.name}ì€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                continue;
            }

            uploadedFiles.push(file);
        }

        updateFileList();
        this.value = '';
    });

    // íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
    function updateFileList() {
        const fileList = document.getElementById('fileList');
        fileList.innerHTML = '';

        uploadedFiles.forEach((file, index) => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <span>ğŸ“ ${file.name} (${formatFileSize(file.size)})</span>
                <button type="button" class="file-remove" onclick="removeFile(${index})">Ã—</button>
            `;
            fileList.appendChild(fileItem);
        });
    }

    // íŒŒì¼ ì œê±°
    function removeFile(index) {
        uploadedFiles.splice(index, 1);
        updateFileList();
    }

    // íŒŒì¼ í¬ê¸° í¬ë§·
    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // ë¯¸ë¦¬ë³´ê¸° í† ê¸€
    function togglePreview() {
        const content = document.getElementById('content');
        const preview = document.getElementById('previewMode');
        const button = event.target;

        isPreviewMode = !isPreviewMode;

        if (isPreviewMode) {
            content.style.display = 'none';
            preview.style.display = 'block';
            button.textContent = 'í¸ì§‘ëª¨ë“œ';
            updatePreview();
        } else {
            content.style.display = 'block';
            preview.style.display = 'none';
            button.textContent = 'ë¯¸ë¦¬ë³´ê¸°';
        }
    }

    // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updatePreview() {
        if (!isPreviewMode) return;

        const title = document.getElementById('title').value || 'ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”';
        const content = document.getElementById('content').value || 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”';

        document.getElementById('previewTitle').textContent = title;
        document.getElementById('previewContent').innerHTML = content.replace(/\n/g, '<br>');
    }

    // ì„ì‹œì €ì¥
    function saveDraft() {
        const formData = {
            category: document.getElementById('category').value,
            title: document.getElementById('title').value,
            content: document.getElementById('content').value,
            tags: document.getElementById('tags').value,
            allowComments: document.getElementById('allowComments').checked,
            isNotice: document.getElementById('isNotice').checked,
            timestamp: new Date().toISOString()
        };

        // ì‹¤ì œë¡œëŠ” ì„œë²„ì— ì €ì¥í•˜ê±°ë‚˜ localStorage ì‚¬ìš©
        alert('ì„ì‹œì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ì·¨ì†Œ
    function goBack() {
        if (confirm('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            history.back();
        }
    }

    // í¼ ì œì¶œ
    document.getElementById('writeForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const category = document.getElementById('category').value;
        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;

        if (!category) {
            alert('ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        if (!title.trim()) {
            alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (!content.trim()) {
            alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        // ì‹¤ì œë¡œëŠ” ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
        const formData = new FormData();
        formData.append('category', category);
        formData.append('title', title);
        formData.append('content', content);
        formData.append('tags', document.getElementById('tags').value);
        formData.append('allowComments', document.getElementById('allowComments').checked);
        formData.append('isNotice', document.getElementById('isNotice').checked);

        uploadedFiles.forEach(file => {
            formData.append('files', file);
        });

        alert('ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        // window.location.href = '/board'; // ê²Œì‹œíŒìœ¼ë¡œ ì´ë™
    });

    // ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤í¬ë¡¤ íš¨ê³¼
    window.addEventListener('scroll', function() {
        const header = document.querySelector('header');
        if (window.scrollY > 50) {
            header.style.background = 'rgba(255, 255, 255, 0.15)';
        } else {
            header.style.background = 'rgba(255, 255, 255, 0.1)';
        }
    });

    // í˜ì´ì§€ ë– ë‚˜ê¸° ì „ í™•ì¸
    window.addEventListener('beforeunload', function(e) {
        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;

        if (title.trim() || content.trim()) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
  </script>
</body>
</html>